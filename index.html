<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviator - Login</title>
    <!-- ... (All CSS from before is unchanged) ... -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>:root { --bg-main: #0f1923; --bg-panel: #212d3a; --text-primary: #ffffff; --green: #00c74a; --red: #ff5555; } body { font-family: 'Poppins', sans-serif; background-color: var(--bg-main); color: var(--text-primary); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; } .login-container { background-color: var(--bg-panel); padding: 30px; border-radius: 10px; width: 90%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); } .tabs { display: flex; border-bottom: 1px solid var(--bg-main); margin-bottom: 20px; } .tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; background: transparent; border: none; color: var(--text-primary); font-size: 1.1em; opacity: 0.6; } .tab.active { border-bottom: 2px solid var(--green); opacity: 1; } h2 { text-align: center; margin-bottom: 20px; } .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; } .form-group input { width: 100%; padding: 12px; background: var(--bg-main); border: 1px solid #334150; border-radius: 5px; color: var(--text-primary); font-size: 1em; box-sizing: border-box; } .submit-btn { width: 100%; padding: 12px; background-color: var(--green); border: none; border-radius: 5px; color: var(--text-primary); font-size: 1.1em; font-weight: 600; cursor: pointer; margin-top: 10px; } #signup-form { display: none; } #error-message { color: var(--red); text-align: center; margin-top: 15px; min-height: 20px; }</style>
</head>
<body>
    <div class="login-container">
        <div class="tabs">
            <button class="tab active" id="login-tab">লগইন</button>
            <button class="tab" id="signup-tab">সাইন আপ</button>
        </div>
        
        <form id="login-form">
            <h2>স্বাগতম</h2>
            <div class="form-group"><label for="login-email">ইমেইল</label><input type="email" id="login-email" required></div>
            <div class="form-group"><label for="login-password">পাসওয়ার্ড</label><input type="password" id="login-password" required></div>
            <button type="submit" class="submit-btn">লগইন করুন</button>
        </form>

        <form id="signup-form">
            <h2>নতুন অ্যাকাউন্ট তৈরি করুন</h2>
            <div class="form-group"><label for="signup-email">ইমেইল</label><input type="email" id="signup-email" required></div>
            <div class="form-group"><label for="signup-password">পাসওয়ার্ড</label><input type="password" id="signup-password" required></div>
            <div class="form-group"><label for="referral-code">Referral Code (Optional)</label><input type="text" id="referral-code"></div>
            <button type="submit" class="submit-btn">সাইন আপ করুন</button>
        </form>

        <p id="error-message"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getDatabase, ref, set, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
        const firebaseConfig = { apiKey: "AIzaSyDg1GQ-TApuxhLSKnQu3YMmjXP6_xXlTig", authDomain: "aviator-96468.firebaseapp.com", databaseURL: "https://aviator-96468-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "aviator-96468", storageBucket: "aviator-96468.firebasestorage.app", messagingSenderId: "265192541811", appId: "1:265192541811:web:6bdb146496593473fce406" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const errorMessage = document.getElementById('error-message');
        const referralCodeInput = document.getElementById('referral-code');

        // Autofill referral code from URL
        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get('ref');
        if (refCode) {
            referralCodeInput.value = refCode;
        }

        onAuthStateChanged(auth, (user) => { if (user) { window.location.href = 'game.html'; } });
        loginTab.addEventListener('click', () => { loginTab.classList.add('active'); signupTab.classList.remove('active'); loginForm.style.display = 'block'; signupForm.style.display = 'none'; });
        signupTab.addEventListener('click', () => { signupTab.classList.add('active'); loginTab.classList.remove('active'); signupForm.style.display = 'block'; loginForm.style.display = 'none'; });

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const referralCode = referralCodeInput.value.trim();

            let referrerId = null;
            if (referralCode) {
                const userQuery = query(ref(db, 'users'), orderByChild('referralCode'), equalTo(referralCode));
                const snapshot = await get(userQuery);
                if (snapshot.exists()) {
                    referrerId = Object.keys(snapshot.val())[0];
                } else {
                    errorMessage.textContent = "Invalid referral code.";
                    return;
                }
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                await set(ref(db, 'users/' + user.uid), {
                    email: user.email,
                    balance: 0,
                    referralCode: user.uid.substring(0, 8),
                    referralCount: 0,
                    referredBy: referrerId || null
                });
            } catch (error) {
                errorMessage.textContent = error.message;
            }
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            signInWithEmailAndPassword(auth, email, password).catch((error) => { errorMessage.textContent = 'ভুল ইমেইল অথবা পাসওয়ার্ড।'; });
        });
    </script>
</body>
</html>
